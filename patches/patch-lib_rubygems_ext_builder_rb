$OpenBSD: patch-lib_rubygems_ext_builder_rb,v 1.1.1.1 2013/03/19 23:38:23 jeremy Exp $

Ugly hack to make --user-install option work.  Without this, when
a user uses gem install --user-install, it calls
/usr/bin/install -o root -g bin, which fails due to permission issues.
This removes the -o root -g bin, so it can succeed as a regular user.

--- lib/rubygems/ext/builder.rb.orig	Mon Feb  4 18:37:35 2013
+++ lib/rubygems/ext/builder.rb	Fri Feb  8 08:23:36 2013
@@ -19,6 +19,7 @@ class Gem::Ext::Builder
     mf = Gem.read_binary 'Makefile'
     mf = mf.gsub(/^RUBYARCHDIR\s*=\s*\$[^$]*/, "RUBYARCHDIR = #{dest_path}")
     mf = mf.gsub(/^RUBYLIBDIR\s*=\s*\$[^$]*/, "RUBYLIBDIR = #{dest_path}")
+    mf = mf.gsub(/-o root -g bin/, "") unless Process.euid == 0
     mf = mf.gsub(/\s*\S+\.time$/, "")
 
     File.open('Makefile', 'wb') {|f| f.print mf}
